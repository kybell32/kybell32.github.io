<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>소셜 미디어 연구_p10</title>
<style>
  body{margin:0;height:100vh;display:flex;align-items:center;justify-content:center;background:#ffffff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif;color:#111827}
  .card{max-width:640px;width:100%;margin:0 16px;background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.06);padding:28px;text-align:center}
  h1{margin:0 0 12px;font-size:22px}
  p{margin:8px 0;line-height:1.7}
  .muted{color:#6b7280;font-size:12px;margin-top:12px}
</style>
</head>
<body>
  <main class="card" aria-labelledby="ttl">
    <h1 id="ttl">연구 종료</h1>
    <p>모든 절차가 완료되었습니다. 참여해 주셔서 대단히 감사합니다.</p>
    <p>연락처로 디브리핑 및 보상 안내를 드리겠습니다.</p>
    <p>평안한 하루 보내세요 :)</p>
    <p class="muted" id="saveStatus">저장 중…</p>
  </main>

<script>
/***** ▼ 설정 ▼ *****/
const API = "https://script.google.com/macros/s/AKfycbxhI7GJJI2jebIWhxr_3nkvvYStEtzNjFZpUuIezsnNKd7G1Mf8emvyrW_AJUsZNg2U/exec";
const PAGE = 11;
/***** ▲ 설정 끝 ▲*/

(function(){
  const qs = new URLSearchParams(location.search);
  const pid = qs.get('pid') || localStorage.getItem('exp_pid') || '';
  const saveStatus = document.getElementById('saveStatus');

  async function sessionUpsert(answers){
    const payload = { type:'SESSION_UPSERT', pid, page: PAGE, answers };
    try{
      const res = await fetch(API, {
        method:'POST',
        headers:{'Content-Type':'text/plain'},
        body: JSON.stringify(payload)
      });
      return res.ok;
    }catch(e){ console.warn(e); return false; }
  }

  async function finalize(){
    const ok = await sessionUpsert([
      { key:'P10_COMPLETE', value:'1' },
      { key:'P10_MESSAGE', value:'연구 종료 안내 표시' },
      { key:'STUDY_STATUS', value:'complete' }
    ]);
    saveStatus.textContent = ok ? '저장 완료' : '저장 실패(네트워크 확인 필요)';
  }

  finalize();

  // 페이지 닫기/새로고침 대비 sendBeacon
  window.addEventListener('beforeunload', ()=>{
    try{
      const payload = JSON.stringify({
        type:'SESSION_UPSERT',
        pid,
        page: PAGE,
        answers:[
          { key:'P10_COMPLETE', value:'1' },
          { key:'P10_MESSAGE', value:'연구 종료 안내 표시' },
          { key:'STUDY_STATUS', value:'complete' }
        ]
      });
      navigator.sendBeacon(API, new Blob([payload], {type:'text/plain'}));
    }catch(e){}
  });
})();
</script>
</body>
</html>
