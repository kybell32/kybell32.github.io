<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì†Œì…œ ë¯¸ë””ì–´ ì—°êµ¬_p5</title>
<style>
  :root{--bg:#f6f7f9;--card:#fff;--line:#e5e7eb;--pri:#2563eb;--muted:#6b7280}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif;color:#111827}
  header{
    position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);
    padding:10px 16px;z-index:10;
    display:flex;justify-content:space-between;align-items:center;
  }
  .brand{font-weight:700}
  .status{font-size:14px;color:var(--muted);display:flex;align-items:center;gap:4px;}

  main{max-width:760px;margin:16px auto;padding:0 16px}
  .post{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.04)}
  .row{display:flex;gap:12px;align-items:center}
  .avatar{width:40px;height:40px;border-radius:999px;background:#d1d5db}
  h2{margin:0;font-size:18px}
  .meta{font-size:12px;color:var(--muted)}
  .content{margin-top:10px;white-space:pre-wrap;line-height:1.7}
  .stats{display:flex;gap:16px;align-items:center;color:#374151;margin-top:12px;font-size:14px}
  .progress{height:6px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin-top:12px}
  .bar{height:100%;width:0%;background:var(--pri)}
</style>
</head>
<body>
<header>
  <div class="brand">í”¼ë“œ</div>
  <div id="statusArea" class="status">
    <span>ì €ì¥ ì¤‘...</span>
  </div>
</header>

<main>
  <article class="post">
    <div class="row">
      <div class="avatar" aria-hidden="true"></div>
      <div>
        <h2 id="title">ì œëª©</h2>
        <div class="meta">@user â€¢ ì§€ê¸ˆ</div>
      </div>
    </div>
    <div id="body" class="content"></div>
    <div class="stats">
      <div>ê³µìœ  <strong id="shareCnt">0</strong></div>
      <div>ì¢‹ì•„ìš” <strong id="likeCnt">0</strong></div>
      <div>ëŒ“ê¸€ <strong id="commentCnt">0</strong></div>
      <div>ì €ì¥ <strong id="saveCnt">0</strong></div>
    </div>
    <div class="progress"><div id="bar" class="bar"></div></div>
  </article>
</main>

<script>
/***** â–¼ ì„¤ì • â–¼ *****/
const API = "https://script.google.com/macros/s/AKfycbxhI7GJJI2jebIWhxr_3nkvvYStEtzNjFZpUuIezsnNKd7G1Mf8emvyrW_AJUsZNg2U/exec";
const DURATION_SEC = 45;
const NEXT_PAGE_URL = "page7.html";
/***** â–² ì„¤ì • ë â–² *****/

(function(){
  const qs = new URLSearchParams(location.search);
  const pid = qs.get('pid') || localStorage.getItem('exp_pid') || '';
  const statusArea = document.getElementById('statusArea');
  const secEl = document.createElement('div');
  let sending = false;

  // ìê·¹ í…ìŠ¤íŠ¸ (A/B)
  const stimuli = {
    A: {
      key: 'A',
      title: 'ì •ì¹˜ë³‘ìë“¤ì´ ë¬¼ì— ë¹ ì¡Œë‹¤.txt',
      body: `ì •ì¹˜ë³‘ìë“¤ì´ ë¬¼ì— ë¹ ì¡Œë‹¤.
ì–´ë–¤ ì‚¬ëŒì´ ì¬ë¹¨ë¦¬ ë‹¬ë ¤ê°€ í•œ ê°€ì§€ ì§ˆë¬¸ì„ í•˜ê³ ëŠ” ë‹¤ì‹œ ëŒì•„ê°”ë‹¤.

ê·¸ ì¥ë©´ì„ ëª©ê²©í•œ ì§€ë‚˜ê°€ë˜ í–‰ì¸ì´ ì´ìƒí•˜ê²Œ ìƒê°í•˜ì—¬
ê·¸ ì‚¬ëŒì—ê²Œ ë‹¤ê°€ê°€ ë¬¼ì—ˆë‹¤.

â€œì™œ ì•„ë¬´ë„ êµ¬í•˜ì§€ ì•Šì•˜ì†Œ?â€

ê·¸ëŸ¬ì ê·¸ ì‚¬ëŒì´ ëŒ€ë‹µí–ˆë‹¤.

â€œë‘˜ì€ ì •ì¹˜ë³‘ìì¸ë° í•˜ë‚˜ëŠ” ì¢Œë¹¨, í•˜ë‚˜ëŠ” ìˆ˜êµ¬ê¼´í†µì´ë”ì´ë‹¤. ë‘˜ ë‹¤ êµ¬í•˜ë©´ ì§€ë“¤ì´ ë¬¼ì— ë¹ ì§„ ê²Œ ì§€ê¸ˆ ì •ê¶Œ ë•Œë¬¸ì´ë‹ˆ ì§€ë‚œ ì •ê¶Œ ë•Œë¬¸ì´ë‹ˆ ë§ìƒì§ˆí•˜ë©° ì‹¸ìš¸ í…Œê³ , ë³´ìˆ˜ ìª½ë§Œ êµ¬í•˜ìë‹ˆ ì§„ë³´ê°€ â€˜ë‚ .ë²„ë¦¬ë©´ ë„Œ.ê¸°ë“ê¶Œ .ì•ì¡ì´ë‹¤â€™ í•˜ê³ , ì§„ë³´ ìª½ë§Œ êµ¬í•˜ìë‹ˆ ë³´ìˆ˜ê°€ â€˜ë¹¨ê°±ì´ê°€ ë”°ë¡œ ì—†ë„¤. íŠ¹ê²€í•´ë¼! ë©¸ê³µ!â€™ì´ë¼ë©° ëŠ¥ì§€ ë‚®ì€ ë¯¸ì¹œ ì†Œë¦¬ë¥¼ í•´ëŒˆ ê²Œ ë»”í•˜ì–ì†Œ.â€

ê·¸ ë§ì„ ë“¤ì€ í–‰ì¸ì´ ê³ ê°œë¥¼ ë„ë•ì´ë©° ê°€ë˜ ê¸¸ì„ ê³„ì† ê°”ë‹¤.
ê·¸ë¦¬ê³  ì„¸ìƒì€ ì¡°ìš©í•´ì¡Œë‹¤.`
    },
    B: {
      key: 'B',
      title: 'ì •ì¹˜ë³‘ìë“¤ì€ ë‹µì´ ì—†ë‹¤.',
      body: `ì •ì¹˜ë³‘ìë“¤ì€ ë‹µì´ ì—†ë‹¤.
ë§ë„ ì•ˆ í†µí•˜ê³  ê·¸ëƒ¥ ì‚¬íšŒì˜ ì•…ì„.

ì§„ë³´ ì •ì¹˜ë³‘ìë“¤í•œí…Œ ì¡°ê¸ˆì´ë¼ë„ ë³´ìˆ˜ ì…ì¥ìœ¼ë¡œ ì–˜ê¸°í•˜ë©´
ê¸°ë“ê¶Œ í¸ì´ë¼ê³  ì¼ë°˜í™” í•˜ê³ ,

ë³´ìˆ˜ ì •ì¹˜ë³‘ìë“¤í•œí…Œ ì¡°ê¸ˆì´ë¼ë„ ì§„ë³´ ì…ì¥ì„ ì–˜ê¸°í•˜ë©´
ë¹¨ê°±ì´ë¡œ ëª°ì•„ê°.

ì§„ì§œ ì•„ë¬´ ë§¥ë½ ì—†ì´ ì •ì¹˜ë¡œ ì‹œì‘í•´ì„œ ì •ì¹˜ë¡œ ëë‚˜ëŠ” ì–˜ê¸°ë§Œ í•˜ê³ , ë­ë§Œ í•˜ë©´ í”„ë ˆì„ ì”Œìš°ë©´ì„œ ê·¸ ì •ì¹˜ì  í‹€ì—ì„œë§Œ ìƒê°ì„ í•¨. ë§¨ë‚  ì¢Œìš° ê°ˆë¼ì¹˜ê¸°ë¡œ ê³¼ëª°ì… í•˜ëŠ”ë° ì§€ë“¤ì´ ìƒëŒ€ ì§„ì˜ íƒ“í•˜ëŠ” ê±° ë“¤ì–´ë³´ë©´ ë§ìƒ ì¥ì•  ê·¸ ìì²´ì„. ë³´ê³  ì‹¶ì€ ê²ƒë§Œ ë³´ê³  ë“£ê³  ì‹¶ì€ ê²ƒë§Œ ë“£ê³ , ì–´ë””ì„œ ì´ìƒí•œ ìœ íŠœë¸Œ ë³´ê³  ê·¸ê²Œ ì‚¬ì‹¤ì´ë¼ê³  ë¯¿ëŠ” ê²Œ ì •ìƒì ì¸ ì§€ëŠ¥ì´ëƒê³ ..

ì •ì¹˜ë³‘ì€ ì•½ë„ ì•ˆ í†µí•˜ê³  ëª» ê³ ì¹œë‹¤..
ê·¸ëƒ¥ ì‚¬ë¼ì§€ëŠ” ê²Œ ë‹µì„.`
    }
  };

  /******************************
   *  ğŸ”¥ ìˆ˜ì •ëœ ìê·¹ ë°°ì • ë¶€ë¶„
   ******************************/
  
  // localStorage ê¸°ë¡ì„ ë¬´ì‹œí•˜ê³  í•­ìƒ Aë¡œ ì„¤ì •
  localStorage.setItem('stimulus_variant', 'A');
  const variantKey = 'A';
  const variant = stimuli[variantKey];

  /******************************/

  // í™”ë©´ ë°˜ì˜
  document.getElementById('title').textContent = variant.title;
  document.getElementById('body').textContent = variant.body;

  // ë…¸ì¶œ ì§€í‘œ(ê°€ì§œ) ìƒì„±
  const counts = (() => {
    const save = 30 + Math.floor(Math.random()*71);
    const comment = save + 20 + Math.floor(Math.random()*181);
    const like = comment + 50 + Math.floor(Math.random()*601);
    const share = Math.min(2000, like + 100 + Math.floor(Math.random()*901));
    return {share, like, comment, save};
  })();
  document.getElementById('shareCnt').textContent = counts.share.toLocaleString();
  document.getElementById('likeCnt').textContent = counts.like.toLocaleString();
  document.getElementById('commentCnt').textContent = counts.comment.toLocaleString();
  document.getElementById('saveCnt').textContent = counts.save.toLocaleString();

  // Firestore-like ì €ì¥ í•¨ìˆ˜ (Google Apps Script)
  async function sessionUpsert(answers){
    if (!pid) return;
    const payload = { type: 'SESSION_UPSERT', pid, page: 6, answers };
    try {
      statusArea.innerHTML = `
        <span>ì €ì¥ ì¤‘...</span>
      `;
      sending = true;
      const res = await fetch(API, {
        method: 'POST',
        headers: { 'Content-Type':'text/plain' },
        body: JSON.stringify(payload),
        keepalive: true
      });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      await res.json().catch(()=>({}));
      statusArea.innerHTML = `<span style="color:#16a34a;">âœ… ì™„ë£Œ</span>`;
      sending = false;
    } catch(e) {
      console.warn("SESSION_UPSERT ì˜¤ë¥˜:", e);
      statusArea.innerHTML = `<span style="color:#dc2626;">âš  ì €ì¥ ì‹¤íŒ¨</span>`;
      sending = false;
    }
  }

  // ì €ì¥ í›„ í˜ì´ì§€ ì´ë™
  async function logVariantAndRedirect(){
    await sessionUpsert([{ key: 'P5_VARIANT', value: variant.key }]);
    await new Promise(r => setTimeout(r, 300));
    if (!sending) location.href = `${NEXT_PAGE_URL}?pid=${encodeURIComponent(pid)}`;
  }

  // 45ì´ˆ íƒ€ì´ë¨¸
  const secDisplay = document.createElement('div');
  secDisplay.id = 'sec';
  const timerNode = document.querySelector('.brand');
  let left = DURATION_SEC;
  const barEl = document.getElementById('bar');
  function tick(){
    left = Math.max(0, left - 1);
    barEl.style.width = ((DURATION_SEC - left)/DURATION_SEC)*100 + '%';
    if (left === 0){ clearInterval(interval); logVariantAndRedirect(); }
  }
  const interval = setInterval(tick, 1000);
  setTimeout(logVariantAndRedirect, DURATION_SEC*1000 + 500);
})();
</script>
</body>
</html>
