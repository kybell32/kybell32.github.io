<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>소셜 미디어 연구_p6 </title>
<style>
  :root{--line:#e5e7eb;--pri:#2563eb;--muted:#6b7280;--bg:#f6f7f9}
  *{box-sizing:border-box}
  body{margin:0;background:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif;color:#111827;line-height:1.6}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:12px;text-align:center;font-weight:700}
  main{max-width:880px;margin:0 auto;padding:16px}
  h1{font-size:20px;margin:6px 0 16px}

  /* 카드형 컨테이너 */
  .card{background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.04);padding:14px}

  .q{border:1px solid var(--line);border-radius:12px;padding:12px;margin-top:12px}
  .qname{font-weight:700;margin-bottom:8px}

  /* 칩 스케일: 한 줄 유지 + 필요시 가로 스크롤 */
  .scale{
    display:flex; flex-wrap:nowrap; gap:8px;
    overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-width:none;
  }
  .scale::-webkit-scrollbar{ display:none; }

  /* 칩(블럭) */
  label.chip{
    position:relative; display:inline-flex; align-items:center;
    border:1px solid var(--line); border-radius:999px;
    padding:8px 10px; background:#fff; cursor:pointer; user-select:none;
    white-space:nowrap; line-height:1; transition:background .15s, border-color .15s, box-shadow .15s;
    font-size:14px;
  }
  /* 라디오 숨김(접근성 유지: 전체 칩 클릭 가능) */
  label.chip > input{
    position:absolute; inset:0; opacity:0; width:100%; height:100%; margin:0; cursor:pointer;
  }
  label.chip strong{ font-variant-numeric:tabular-nums; font-weight:700 }
  label.chip:hover{ background:#f9fafb }
  label.chip:focus-within{ box-shadow:0 0 0 3px rgba(37,99,235,.2) }

  /* 선택 상태 */
  label.chip.selected{
    background:#eef2ff;
    border-color:#93c5fd;
    box-shadow:inset 0 0 0 2px #2563eb;
  }
  label.chip.selected strong{ color:#1d4ed8 }

  .btn-area{text-align:center;margin-top:20px}
  .btn{border:none;border-radius:10px;padding:12px 18px;font-size:16px;background:var(--pri);color:#fff;font-weight:600;cursor:pointer}
  .btn:disabled{opacity:.5;cursor:not-allowed}

  /* 모바일 최적화: 패딩/간격 더 타이트 */
  @media (max-width:480px){
    main{padding:12px}
    .card{padding:12px}
    .q{padding:10px}
    .scale{gap:6px}
    label.chip{padding:8px 9px;font-size:13.5px}
  }
</style>
</head>
<body>
<header>문답</header>
<main>
  <h1>앞서 본 온라인 게시물의 어조에 대해 어느 정도 동의하는지 선택해 주세요.</h1>

  <section class="card">
    <div class="q">
      <div class="qname">1) 웃기다.</div>
      <div class="scale" data-name="q1" data-qkey="P6_Q1"></div>
    </div>

    <div class="q">
      <div class="qname">2) 재미있다.</div>
      <div class="scale" data-name="q2" data-qkey="P6_Q2"></div>
    </div>

    <div class="q">
      <div class="qname">3) 농담조가 강하다.</div>
      <div class="scale" data-name="q3" data-qkey="P6_Q3"></div>
    </div>
  </section>

  <div class="btn-area">
    <button id="nextBtn" type="button" class="btn" disabled>다음</button>
  </div>
</main>

<script>
/***** ▼ 설정 ▼ *****/
const API = "https://script.google.com/macros/s/AKfycbxhI7GJJI2jebIWhxr_3nkvvYStEtzNjFZpUuIezsnNKd7G1Mf8emvyrW_AJUsZNg2U/exec";
const PAGE = 6;
const NEXT_PAGE_URL = "page7.html";
/***** ▲ 설정 끝 ▲ *****/

(function(){
  const qs = new URLSearchParams(location.search);
  const pid = qs.get('pid') || localStorage.getItem('exp_pid') || '';
  const nextBtn = document.getElementById('nextBtn');
  let sending = false;

  // 1) 칩 UI 생성(1~5)
  document.querySelectorAll('.scale').forEach(scale=>{
    const name = scale.dataset.name;
    for(let v=1; v<=5; v++){
      const lab = document.createElement('label');
      lab.className = 'chip';
      lab.innerHTML = `<input type="radio" name="${name}" value="${v}"><strong>${v}</strong>`;
      scale.appendChild(lab);
    }
  });

  // 2) 칩 선택 시 블럭 강조(.selected 토글)
  function refreshGroup(name){
    document.querySelectorAll(`label.chip input[name="${name}"]`).forEach(r=>{
      const lab = r.closest('label.chip');
      if (!lab) return;
      lab.classList.toggle('selected', r.checked);
    });
  }
  function wireChipSelection(){
    document.querySelectorAll('label.chip > input[type="radio"]').forEach(r=>{
      // 초기 반영
      refreshGroup(r.name);
      r.addEventListener('change', ()=>refreshGroup(r.name));
    });
  }
  wireChipSelection();

  // 3) 완료 체크
  const REQUIRED = ['q1','q2','q3'];
  function allAnswered(){
    return REQUIRED.every(n => document.querySelector(`input[name="${n}"]:checked`));
  }
  function refreshBtn(){ nextBtn.disabled = !allAnswered() || sending; }

  // 변화 감지(성능: 위임)
  document.addEventListener('change', (e)=>{
    if (e.target && e.target.matches('input[type="radio"]')) refreshBtn();
  });
  refreshBtn();

  // 4) 저장 & 이동
  async function sessionUpsert(answers){
    const payload = { type:'SESSION_UPSERT', pid, page: PAGE, answers };
    const res = await fetch(API, {
      method: 'POST',
      headers: { 'Content-Type':'text/plain' },
      body: JSON.stringify(payload)
    });
    if (!res.ok) console.warn('SESSION_UPSERT failed:', res.status);
  }

  nextBtn.addEventListener('click', async ()=>{
    if (!allAnswered() || sending) return;
    sending = true; refreshBtn();

    function valOf(name){ return document.querySelector(`input[name="${name}"]:checked`).value; }
    const answers = [
      { key:'P6_Q1', value: valOf('q1') },
      { key:'P6_Q2', value: valOf('q2') },
      { key:'P6_Q3', value: valOf('q3') }
    ];

    try { await sessionUpsert(answers); } catch(e){ console.warn(e); }

    const next = `${NEXT_PAGE_URL}?pid=${encodeURIComponent(pid)}`;
    location.href = next;
  });

})();
</script>
</body>
</html>
