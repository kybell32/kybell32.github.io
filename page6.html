<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>소셜 미디어 연구_p5</title>
<style>
  :root{--bg:#f6f7f9;--card:#fff;--line:#e5e7eb;--pri:#2563eb;--muted:#6b7280}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif;color:#111827}
  header{
    position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);
    padding:10px 16px;z-index:10;
    display:flex;justify-content:space-between;align-items:center;
  }
  .brand{font-weight:700}
  .status{font-size:14px;color:var(--muted);display:flex;align-items:center;gap:4px;}

  main{max-width:760px;margin:16px auto;padding:0 16px}
  .post{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.04)}
  .row{display:flex;gap:12px;align-items:center}
  .avatar{width:40px;height:40px;border-radius:999px;background:#d1d5db}
  h2{margin:0;font-size:18px}
  .meta{font-size:12px;color:var(--muted)}
  .content{margin-top:10px;white-space:pre-wrap;line-height:1.7}
  .stats{display:flex;gap:16px;align-items:center;color:#374151;margin-top:12px;font-size:14px}
  .progress{height:6px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin-top:12px}
  .bar{height:100%;width:0%;background:var(--pri)}
</style>
</head>
<body>
<header>
  <div class="brand">피드</div>
  <div id="statusArea" class="status">
    <span>저장 중...</span>
  </div>
</header>

<main>
  <article class="post">
    <div class="row">
      <div class="avatar" aria-hidden="true"></div>
      <div>
        <h2 id="title">제목</h2>
        <div class="meta">@user • 지금</div>
      </div>
    </div>
    <div id="body" class="content"></div>
    <div class="stats">
      <div>공유 <strong id="shareCnt">0</strong></div>
      <div>좋아요 <strong id="likeCnt">0</strong></div>
      <div>댓글 <strong id="commentCnt">0</strong></div>
      <div>저장 <strong id="saveCnt">0</strong></div>
    </div>
    <div class="progress"><div id="bar" class="bar"></div></div>
  </article>
</main>

<script>
/***** ▼ 설정 ▼ *****/
const API = "https://script.google.com/macros/s/AKfycbxhI7GJJI2jebIWhxr_3nkvvYStEtzNjFZpUuIezsnNKd7G1Mf8emvyrW_AJUsZNg2U/exec";
const DURATION_SEC = 45;
const NEXT_PAGE_URL = "page7.html";
/***** ▲ 설정 끝 ▲ *****/

(function(){
  const qs = new URLSearchParams(location.search);
  const pid = qs.get('pid') || localStorage.getItem('exp_pid') || '';
  const statusArea = document.getElementById('statusArea');
  const secEl = document.createElement('div');
  let sending = false;

  // 자극 텍스트 (A/B)
  const stimuli = {
    A: {
      key: 'A',
      title: '정치병자들이 물에 빠졌다.txt',
      body: `정치병자들이 물에 빠졌다.
어떤 사람이 재빨리 달려가 한 가지 질문을 하고는 다시 돌아갔다.

그 장면을 목격한 지나가던 행인이 이상하게 생각하여
그 사람에게 다가가 물었다.

“왜 아무도 구하지 않았소?”

그러자 그 사람이 대답했다.

“둘은 정치병자인데 하나는 좌빨, 하나는 수구꼴통이더이다. 둘 다 구하면 지들이 물에 빠진 게 지금 정권 때문이니 지난 정권 때문이니 망상질하며 싸울 테고, 보수 쪽만 구하자니 진보가 ‘날.버리면 넌.기득권 .앞잡이다’ 하고, 진보 쪽만 구하자니 보수가 ‘빨갱이가 따로 없네. 특검해라! 멸공!’이라며 능지 낮은 미친 소리를 해댈 게 뻔하잖소.”

그 말을 들은 행인이 고개를 끄덕이며 가던 길을 계속 갔다.
그리고 세상은 조용해졌다.`
    },
    B: {
      key: 'B',
      title: '정치병자들은 답이 없다.',
      body: `정치병자들은 답이 없다.
말도 안 통하고 그냥 사회의 악임.

진보 정치병자들한테 조금이라도 보수 입장으로 얘기하면
기득권 편이라고 일반화 하고,

보수 정치병자들한테 조금이라도 진보 입장을 얘기하면
빨갱이로 몰아감.

진짜 아무 맥락 없이 정치로 시작해서 정치로 끝나는 얘기만 하고, 뭐만 하면 프레임 씌우면서 그 정치적 틀에서만 생각을 함. 맨날 좌우 갈라치기로 과몰입 하는데 지들이 상대 진영 탓하는 거 들어보면 망상 장애 그 자체임. 보고 싶은 것만 보고 듣고 싶은 것만 듣고, 어디서 이상한 유튜브 보고 그게 사실이라고 믿는 게 정상적인 지능이냐고..

정치병은 약도 안 통하고 못 고친다..
그냥 사라지는 게 답임.`
    }
  };

  // 자극 배정
  let variantKey = localStorage.getItem('stimulus_variant');
  if (!variantKey) {
    variantKey = Math.random() < 0.9 ? 'A' : 'B';
    localStorage.setItem('stimulus_variant', variantKey);
  }
  const variant = stimuli[variantKey];

  // 화면 반영
  document.getElementById('title').textContent = variant.title;
  document.getElementById('body').textContent = variant.body;

  // 노출 지표(가짜) 생성
  const counts = (() => {
    const save = 30 + Math.floor(Math.random()*71);
    const comment = save + 20 + Math.floor(Math.random()*181);
    const like = comment + 50 + Math.floor(Math.random()*601);
    const share = Math.min(2000, like + 100 + Math.floor(Math.random()*901));
    return {share, like, comment, save};
  })();
  document.getElementById('shareCnt').textContent = counts.share.toLocaleString();
  document.getElementById('likeCnt').textContent = counts.like.toLocaleString();
  document.getElementById('commentCnt').textContent = counts.comment.toLocaleString();
  document.getElementById('saveCnt').textContent = counts.save.toLocaleString();

  // Firestore-like 저장 함수 (Google Apps Script)
  async function sessionUpsert(answers){
    if (!pid) return;
    const payload = { type: 'SESSION_UPSERT', pid, page: 6, answers };
    try {
      statusArea.innerHTML = `
        <span>저장 중...</span>
      `;
      sending = true;
      const res = await fetch(API, {
        method: 'POST',
        headers: { 'Content-Type':'text/plain' },
        body: JSON.stringify(payload),
        keepalive: true
      });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      await res.json().catch(()=>({}));
      statusArea.innerHTML = `<span style="color:#16a34a;">✅ 완료</span>`;
      sending = false;
    } catch(e) {
      console.warn("SESSION_UPSERT 오류:", e);
      statusArea.innerHTML = `<span style="color:#dc2626;">⚠ 저장 실패</span>`;
      sending = false;
    }
  }

  // 저장 후 페이지 이동
  async function logVariantAndRedirect(){
    await sessionUpsert([{ key: 'P5_VARIANT', value: variant.key }]);
    await new Promise(r => setTimeout(r, 300));
    if (!sending) location.href = `${NEXT_PAGE_URL}?pid=${encodeURIComponent(pid)}`;
  }

  // 45초 타이머
  const secDisplay = document.createElement('div');
  secDisplay.id = 'sec';
  const timerNode = document.querySelector('.brand');
  let left = DURATION_SEC;
  const barEl = document.getElementById('bar');
  function tick(){
    left = Math.max(0, left - 1);
    barEl.style.width = ((DURATION_SEC - left)/DURATION_SEC)*100 + '%';
    if (left === 0){ clearInterval(interval); logVariantAndRedirect(); }
  }
  const interval = setInterval(tick, 1000);
  setTimeout(logVariantAndRedirect, DURATION_SEC*1000 + 500);
})();
</script>
</body>
</html>
