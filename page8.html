<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>실험 v2 · Page 8 (종속 변인 측정 게시물)</title>
<style>
  :root{--line:#e5e7eb;--pri:#2563eb}
  body{margin:0;background:#f6f7f9;font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif;color:#111827}
  .container{max-width:720px;margin:20px auto;padding:0 16px}
  .notice{margin-bottom:16px;font-size:18px;font-weight:600;text-align:center}
  .card{background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.05);padding:16px}
  .profile{display:flex;align-items:center;gap:10px;margin-bottom:12px}
  .avatar{width:40px;height:40px;border-radius:50%;background:#d1d5db;display:flex;align-items:center;justify-content:center;font-weight:700;color:#374151}
  .author{font-size:14px;font-weight:600;color:#111827}
  .title{font-weight:700;font-size:18px;margin-bottom:10px}
  .content{white-space:pre-line;line-height:1.6;font-size:15px}
  .stats{display:flex;gap:16px;align-items:center;color:#374151;margin-top:12px;font-size:14px}
  .progress{height:6px;background:#e5e7eb;border-radius:4px;margin-top:20px;overflow:hidden}
  .bar{height:100%;width:0;background:var(--pri);transition:width 1s linear}
</style>
</head>
<body>
<div class="container">
  <div class="notice">아래 게시물을 읽은 후 다음 질문에 답해 주십시오.</div>
  <div class="card">
    <div class="profile">
      <div class="avatar">A</div>
      <div class="author">익명</div>
    </div>
    <div class="title">정신질환자들은 사회에 필요 없다.</div>
    <div id="body" class="content"></div>
    <div class="stats">
      <div>공유 <strong id="shareCnt">0</strong></div>
      <div>좋아요 <strong id="likeCnt">0</strong></div>
      <div>댓글 <strong id="commentCnt">0</strong></div>
      <div>저장 <strong id="saveCnt">0</strong></div>
    </div>
    <div class="progress"><div id="bar" class="bar"></div></div>
  </div>
</div>

<script>
const LOG_ENDPOINT = "https://script.google.com/macros/s/AKfycbzWbwi4PQYcZnJoKe1uTXaVUxeQFUwbY42I9R6wIead6KkIoqIF5IkTNy6sUZfbKeS_/exec";
const NEXT_PAGE_URL = "page9.html";
const DISPLAY_MS = 45000; // 45초

const text = `정신질환자들은 솔직히 사회에서는 짐이지.
약 먹으면서도 일도 제대로 못하고, 주변 사람까지 힘들게 만드니까.

요즘은 조금만 힘들어도 다들 정신병이라고 우기는데
그건 핑계고, 솔직히 진짜 정신병은 심각하잖아.

더 문제는 사회에서 이런 사람들 배려한다고
세금 쏟아 가면서 일 하게 만들려는데 굳이 그래야 해?

범죄나 문제 일으키는 게 일상 다반사고
주변 사람들한테 피해만 주잖아.
아무리 본인이 원하지 않아도 피해를 주는데 어떻게 해서라도 병동 입원시켜야지.`;

(function(){
  const startMs = performance.now();
  const pid = localStorage.getItem('exp_pid') || new URLSearchParams(location.search).get('pid') || null;
  document.getElementById('body').textContent = text;

  // 노출형 지표 생성 (공유>좋아요>댓글>저장, 저장 최소 30, 공유 최대 2000)
  function genCounts(){
    const save = 30 + Math.floor(Math.random()*21); // 30~50
    const comment = save + Math.floor(Math.random()*100);
    const like = comment + Math.floor(Math.random()*300);
    const share = Math.min(2000, like + Math.floor(Math.random()*500));
    return {share, like, comment, save};
  }
  const counts = genCounts();
  document.getElementById('shareCnt').textContent = counts.share.toLocaleString();
  document.getElementById('likeCnt').textContent = counts.like.toLocaleString();
  document.getElementById('commentCnt').textContent = counts.comment.toLocaleString();
  document.getElementById('saveCnt').textContent = counts.save.toLocaleString();

  async function log(type, detail){
    const payload = {
      type,
      ts: new Date().toISOString(),
      ms: Math.round(performance.now() - startMs),
      pid,
      url: location.href,
      ua: navigator.userAgent,
      detail
    };
    try {
      await fetch(LOG_ENDPOINT, {
        method: 'POST',
        mode: 'no-cors',            // 프리플라이트 방지
        // headers 제거! ('application/json' 쓰면 OPTIONS 발생)
        body: JSON.stringify(payload)
      });
    } catch (e) {
      try {
        // Blob 불필요 — 문자열 그대로 전송
        navigator.sendBeacon && navigator.sendBeacon(LOG_ENDPOINT, JSON.stringify(payload));
      } catch (_) {}
    }
  }

  // 페이지 로드 로그 (이 파일이 Page 8이면 8 유지)
  log('page_load', { page: 8 });

  // 타이머 진행바
  const bar = document.getElementById('bar');
  let elapsed = 0;
  const interval = setInterval(()=>{
    elapsed += 1000;
    bar.style.width = Math.min(100, (elapsed / DISPLAY_MS) * 100) + "%";
    if (elapsed >= DISPLAY_MS) {
      clearInterval(interval);
      log('stimulus_timeout_redirect', {});
      location.href = NEXT_PAGE_URL + (pid ? `?pid=${encodeURIComponent(pid)}` : '');
    }
  }, 1000);
})();
</script>
</body>
</html>
